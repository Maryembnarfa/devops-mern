{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { deepMix } from '@antv/util';\nimport { subObject } from '../utils/helper';\nimport { selectionOf } from '../utils/scale';\nimport { brush as createBrush } from './brushHighlight';\nimport { selectPlotArea } from './utils';\n// Mock dblclick events.\nfunction dblclick() {\n  let interval = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 300;\n  let preTimeStamp = null;\n  return e => {\n    const {\n      timeStamp\n    } = e;\n    if (preTimeStamp !== null && timeStamp - preTimeStamp < interval) {\n      preTimeStamp = timeStamp;\n      return true;\n    }\n    preTimeStamp = timeStamp;\n    return false;\n  };\n}\nexport function brushFilter(root, _a) {\n  var {\n      filter,\n      reset,\n      brushRegion,\n      extent: optionalExtent,\n      reverse,\n      emitter,\n      scale,\n      coordinate,\n      selection,\n      series = false\n    } = _a,\n    rest = __rest(_a, [\"filter\", \"reset\", \"brushRegion\", \"extent\", \"reverse\", \"emitter\", \"scale\", \"coordinate\", \"selection\", \"series\"]);\n  const brushStyle = subObject(rest, 'mask');\n  const {\n    width: rootWidth,\n    height: rootHeight\n  } = root.getBBox();\n  const extent = optionalExtent ? optionalExtent : [0, 0, rootWidth, rootHeight];\n  const isDblclick = dblclick();\n  const brush = createBrush(root, Object.assign(Object.assign({}, brushStyle), {\n    extent,\n    brushRegion,\n    reverse,\n    brushcreated\n  }));\n  root.addEventListener('click', click);\n  // Filter when brush created.\n  function brushcreated(x, y, x1, y1, event) {\n    event.nativeEvent = true;\n    filter(selection(x, y, x1, y1), event);\n    brush.remove();\n  }\n  // Reset when dblclick.\n  function click(e) {\n    if (isDblclick(e)) {\n      e.nativeEvent = true;\n      reset(e);\n    }\n  }\n  const onFilter = _ref => {\n    let {\n      nativeEvent,\n      data\n    } = _ref;\n    if (nativeEvent) return;\n    const {\n      selection\n    } = data;\n    filter(selection, {\n      nativeEvent: false\n    });\n  };\n  emitter.on('brush:filter', onFilter);\n  return () => {\n    brush.destroy();\n    emitter.off('brush:filter', onFilter);\n    root.removeEventListener('click', click);\n  };\n}\nexport function BrushFilter(_a) {\n  var {\n      hideX = true,\n      hideY = true\n    } = _a,\n    rest = __rest(_a, [\"hideX\", \"hideY\"]);\n  return (target, viewInstances, emitter) => {\n    const {\n      container,\n      view,\n      options: viewOptions,\n      update,\n      setState\n    } = target;\n    const plotArea = selectPlotArea(container);\n    const defaultOptions = {\n      maskFill: '#777',\n      maskFillOpacity: '0.3',\n      maskStroke: '#fff',\n      unhighlightedOpacity: 0.5,\n      reverse: false\n    };\n    let filtered = false;\n    let filtering = false;\n    let newView = view;\n    const {\n      scale,\n      coordinate\n    } = view;\n    return brushFilter(plotArea, Object.assign(Object.assign({\n      brushRegion: (x, y, x1, y1) => [x, y, x1, y1],\n      selection: (x, y, x1, y1) => {\n        const {\n          scale,\n          coordinate\n        } = newView;\n        return selectionOf(x, y, x1, y1, scale, coordinate);\n      },\n      filter: (selection, event) => __awaiter(this, void 0, void 0, function* () {\n        // Avoid redundant filter.\n        if (filtering) return;\n        filtering = true;\n        // Update the domain of x and y scale to filter data.\n        const [domainX, domainY] = selection;\n        setState('brushFilter', options => {\n          const {\n            marks\n          } = options;\n          const newMarks = marks.map(mark => deepMix({\n            // Hide label to keep smooth transition.\n            axis: Object.assign(Object.assign({}, hideX && {\n              x: {\n                transform: [{\n                  type: 'hide'\n                }]\n              }\n            }), hideY && {\n              y: {\n                transform: [{\n                  type: 'hide'\n                }]\n              }\n            })\n          }, mark, {\n            // Set nice to false to avoid modify domain.\n            scale: {\n              x: {\n                domain: domainX,\n                nice: false\n              },\n              y: {\n                domain: domainY,\n                nice: false\n              }\n            }\n          }));\n          return Object.assign(Object.assign({}, viewOptions), {\n            marks: newMarks,\n            clip: true\n          });\n        });\n        // Emit event.\n        emitter.emit('brush:filter', Object.assign(Object.assign({}, event), {\n          data: {\n            selection: [domainX, domainY]\n          }\n        }));\n        const newState = yield update();\n        newView = newState.view;\n        filtering = false;\n        filtered = true;\n      }),\n      reset: event => {\n        if (filtering || !filtered) return;\n        // Emit event.\n        const {\n          scale\n        } = view;\n        const {\n          x: scaleX,\n          y: scaleY\n        } = scale;\n        const domainX = scaleX.getOptions().domain;\n        const domainY = scaleY.getOptions().domain;\n        emitter.emit('brush:filter', Object.assign(Object.assign({}, event), {\n          data: {\n            selection: [domainX, domainY]\n          }\n        }));\n        filtered = false;\n        newView = view;\n        setState('brushFilter');\n        update();\n      },\n      extent: undefined,\n      emitter,\n      scale,\n      coordinate\n    }, defaultOptions), rest));\n  };\n}","map":{"version":3,"names":["deepMix","subObject","selectionOf","brush","createBrush","selectPlotArea","dblclick","interval","arguments","length","undefined","preTimeStamp","e","timeStamp","brushFilter","root","_a","filter","reset","brushRegion","extent","optionalExtent","reverse","emitter","scale","coordinate","selection","series","rest","__rest","brushStyle","width","rootWidth","height","rootHeight","getBBox","isDblclick","Object","assign","brushcreated","addEventListener","click","x","y","x1","y1","event","nativeEvent","remove","onFilter","_ref","data","on","destroy","off","removeEventListener","BrushFilter","hideX","hideY","target","viewInstances","container","view","options","viewOptions","update","setState","plotArea","defaultOptions","maskFill","maskFillOpacity","maskStroke","unhighlightedOpacity","filtered","filtering","newView","__awaiter","domainX","domainY","marks","newMarks","map","mark","axis","transform","type","domain","nice","clip","emit","newState","scaleX","scaleY","getOptions"],"sources":["interaction/brushFilter.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}