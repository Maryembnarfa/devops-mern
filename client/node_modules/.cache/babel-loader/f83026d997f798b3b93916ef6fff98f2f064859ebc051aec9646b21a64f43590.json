{"ast":null,"code":"import { deepMix } from '@antv/util';\nimport { defined } from '../utils/helper';\nimport { columnOf } from './utils/helper';\nfunction normalizeValue(value) {\n  if (typeof value === 'object') return [value.value, value.ordinal];else return [value, true];\n}\nfunction filterWhenNoElements(mark) {\n  var _a;\n  const {\n    encode\n  } = mark;\n  // keep y-axis\n  const noElementMark = Object.assign(Object.assign({}, mark), {\n    encode: Object.assign(Object.assign({}, mark.encode), {\n      y: Object.assign(Object.assign({}, mark.encode.y), {\n        value: []\n      })\n    })\n  });\n  const targetField = (_a = encode === null || encode === void 0 ? void 0 : encode.color) === null || _a === void 0 ? void 0 : _a.field;\n  if (!encode || !targetField) {\n    return noElementMark;\n  }\n  // 获取color的筛选源\n  let filterObject;\n  for (const [key, v] of Object.entries(encode)) {\n    if ((key === 'x' || key === 'y') && v.field === targetField) {\n      filterObject = Object.assign(Object.assign({}, filterObject), {\n        [key]: Object.assign(Object.assign({}, v), {\n          value: []\n        })\n      });\n    }\n  }\n  if (!filterObject) {\n    return noElementMark;\n  }\n  return Object.assign(Object.assign({}, mark), {\n    encode: Object.assign(Object.assign({}, mark.encode), filterObject)\n  });\n}\n/**\n * The Filter transform filter channels.\n */\nexport const Filter = function () {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return (I, mark) => {\n    const {\n      encode,\n      data\n    } = mark;\n    const filters = Object.entries(options).map(_ref => {\n      let [key, v] = _ref;\n      const [V] = columnOf(encode, key);\n      // Skip empty channel.\n      if (!V) return null;\n      const [value, ordinal = true] = normalizeValue(v);\n      if (typeof value === 'function') return i => value(V[i]);\n      if (ordinal) {\n        const expectedValues = Array.isArray(value) ? value : [value];\n        // Skip empty expected values.\n        if (expectedValues.length === 0) return null;\n        return i => expectedValues.includes(V[i]);\n      } else {\n        const [start, end] = value;\n        return i => V[i] >= start && V[i] <= end;\n      }\n    }).filter(defined);\n    // Filter index and channels.\n    const totalFilter = i => filters.every(f => f(i));\n    const FI = I.filter(totalFilter);\n    const newIndex = FI.map((_, i) => i);\n    if (filters.length === 0) {\n      const targetMark = filterWhenNoElements(mark);\n      return [I, targetMark];\n    }\n    const newEncodes = Object.entries(encode).map(_ref2 => {\n      let [key, encode] = _ref2;\n      return [key, Object.assign(Object.assign({}, encode), {\n        value: newIndex.map(i => encode.value[FI[i]]).filter(v => v !== undefined)\n      })];\n    });\n    return [newIndex, deepMix({}, mark, {\n      encode: Object.fromEntries(newEncodes),\n      // Filter data for tooltip item.\n      data: FI.map(i => data[i])\n    })];\n  };\n};\nFilter.props = {};","map":{"version":3,"names":["deepMix","defined","columnOf","normalizeValue","value","ordinal","filterWhenNoElements","mark","encode","noElementMark","Object","assign","y","targetField","_a","color","field","filterObject","key","v","entries","Filter","options","arguments","length","undefined","I","data","filters","map","_ref","V","i","expectedValues","Array","isArray","includes","start","end","filter","totalFilter","every","f","FI","newIndex","_","targetMark","newEncodes","_ref2","fromEntries","props"],"sources":["transform/filter.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}