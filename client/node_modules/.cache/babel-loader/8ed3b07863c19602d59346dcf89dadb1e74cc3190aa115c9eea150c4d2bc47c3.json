{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { deepMix } from '@antv/util';\nimport { Container } from '../utils/container';\nimport { calcBBox } from '../utils/vector';\nimport { indexOf } from '../utils/array';\nimport { createInnerGuide, inferColor, setAnimation, setStyle, toCell } from './facetRect';\nimport { useDefaultAdaptor, useOverrideAdaptor } from './utils';\nconst setScale = useDefaultAdaptor(options => {\n  return {\n    scale: {\n      x: {\n        guide: null,\n        paddingOuter: 0,\n        paddingInner: 0.1\n      },\n      y: {\n        guide: null,\n        range: [0, 1],\n        paddingOuter: 0,\n        paddingInner: 0.1\n      }\n    }\n  };\n});\nconst setChildren = useOverrideAdaptor(options => {\n  const {\n    data,\n    children,\n    x: originX = 0,\n    y: originY = 0,\n    key: viewKey\n  } = options;\n  const createChildren = (visualData, scale, layout) => {\n    const {\n      x: scaleX,\n      y: scaleY\n    } = scale;\n    const {\n      paddingLeft,\n      paddingTop,\n      marginLeft,\n      marginTop\n    } = layout;\n    const {\n      domain: domainX\n    } = scaleX.getOptions();\n    const {\n      domain: domainY\n    } = scaleY.getOptions();\n    const index = indexOf(visualData);\n    const bboxs = visualData.map(_ref => {\n      let {\n        points\n      } = _ref;\n      return calcBBox(points);\n    });\n    const values = visualData.map(_ref2 => {\n      let {\n        x,\n        y\n      } = _ref2;\n      return [scaleX.invert(x), scaleY.invert(y)];\n    });\n    const facets = values.map(_ref3 => {\n      let [fx, fy] = _ref3;\n      return {\n        columnField: fx,\n        columnIndex: domainX.indexOf(fx),\n        columnValue: fx,\n        columnValuesLength: domainX.length,\n        rowField: fy,\n        rowIndex: domainY.indexOf(fy),\n        rowValue: fy,\n        rowValuesLength: domainY.length\n      };\n    });\n    const normalizedChildren = facets.map(facet => {\n      if (Array.isArray(children)) return children;\n      return [children(facet)].flat(1);\n    });\n    return index.flatMap(i => {\n      const [left, top, width, height] = bboxs[i];\n      const [fx, fy] = values[i];\n      const facet = facets[i];\n      const children = normalizedChildren[i];\n      return children.map(d => {\n        var _a, _b;\n        const {\n            scale,\n            key,\n            encode,\n            axis,\n            interaction\n          } = d,\n          rest = __rest(d, [\"scale\", \"key\", \"encode\", \"axis\", \"interaction\"]);\n        const guideY = (_a = scale === null || scale === void 0 ? void 0 : scale.y) === null || _a === void 0 ? void 0 : _a.guide;\n        const guideX = (_b = scale === null || scale === void 0 ? void 0 : scale.x) === null || _b === void 0 ? void 0 : _b.guide;\n        const defaultScale = {\n          // Do not sync position scales among facets by default.\n          x: {\n            facet: false\n          },\n          // Do not sync position scales among facets by default.\n          y: {\n            facet: false\n          }\n        };\n        const newAxis = {\n          x: createGuideX(guideX)(facet, data),\n          y: createGuideY(guideY)(facet, data)\n        };\n        const defaultAxis = {\n          x: {\n            tickCount: 5\n          },\n          y: {\n            tickCount: 5\n          }\n        };\n        return Object.assign({\n          data,\n          parentKey: viewKey,\n          key: `${key}-${i}`,\n          x: left + paddingLeft + originX + marginLeft,\n          y: top + paddingTop + originY + marginTop,\n          width,\n          height,\n          margin: 0,\n          paddingLeft: 0,\n          paddingRight: 0,\n          paddingTop: 0,\n          paddingBottom: 0,\n          frame: true,\n          scale: deepMix(defaultScale, scale),\n          axis: deepMix(defaultAxis, axis, newAxis),\n          // Hide all legends for child mark by default,\n          // they are displayed in the top-level.\n          legend: false,\n          encode: deepMix({}, encode, {\n            x: fx,\n            y: fy\n          }),\n          interaction: deepMix({}, interaction, {\n            // Register this interaction in parent node.\n            legendFilter: false\n          })\n        }, rest);\n      });\n    });\n  };\n  return {\n    children: createChildren\n  };\n});\n/**\n * @todo Use transform instead of override data directly.\n */\nconst setData = useOverrideAdaptor(options => {\n  const {\n      encode\n    } = options,\n    rest = __rest(options, [\"encode\"]);\n  const {\n      position: P = [],\n      x: X = P,\n      y: Y = [...P].reverse()\n    } = encode,\n    restEncode = __rest(encode, [\"position\", \"x\", \"y\"]);\n  const data = [];\n  for (const $x of [X].flat(1)) {\n    for (const $y of [Y].flat(1)) {\n      data.push({\n        $x,\n        $y\n      });\n    }\n  }\n  return Object.assign(Object.assign({}, rest), {\n    data,\n    encode: Object.assign(Object.assign({}, restEncode), {\n      x: '$x',\n      y: '$y'\n    }),\n    scale: Object.assign(Object.assign({}, [X].flat(1).length === 1 && {\n      x: {\n        paddingInner: 0\n      }\n    }), [Y].flat(1).length === 1 && {\n      y: {\n        paddingInner: 0\n      }\n    })\n  });\n});\nfunction createGuideX(guideX) {\n  if (typeof guideX === 'function') return guideX;\n  if (guideX === null) return () => null;\n  return (facet, data) => {\n    const {\n      rowIndex,\n      rowValuesLength\n    } = facet;\n    // Only the bottom-most facet show axisX.\n    if (rowIndex !== rowValuesLength - 1) return createInnerGuide(guideX, data);\n  };\n}\nfunction createGuideY(guideY) {\n  if (typeof guideY === 'function') return guideY;\n  if (guideY === null) return () => null;\n  return (facet, data) => {\n    const {\n      columnIndex\n    } = facet;\n    // Only the left-most facet show axisY.\n    if (columnIndex !== 0) return createInnerGuide(guideY, data);\n  };\n}\n/**\n * @todo Layout mode: layer, row, col...\n * @todo Specify show axis or not.\n */\nexport const RepeatMatrix = () => {\n  return options => {\n    const newOptions = Container.of(options).call(toCell).call(inferColor).call(setChildren).call(setData).call(setAnimation).call(setStyle).call(setScale).value();\n    return [newOptions];\n  };\n};","map":{"version":3,"names":["deepMix","Container","calcBBox","indexOf","createInnerGuide","inferColor","setAnimation","setStyle","toCell","useDefaultAdaptor","useOverrideAdaptor","setScale","options","scale","x","guide","paddingOuter","paddingInner","y","range","setChildren","data","children","originX","originY","key","viewKey","createChildren","visualData","layout","scaleX","scaleY","paddingLeft","paddingTop","marginLeft","marginTop","domain","domainX","getOptions","domainY","index","bboxs","map","_ref","points","values","_ref2","invert","facets","_ref3","fx","fy","columnField","columnIndex","columnValue","columnValuesLength","length","rowField","rowIndex","rowValue","rowValuesLength","normalizedChildren","facet","Array","isArray","flat","flatMap","i","left","top","width","height","d","encode","axis","interaction","rest","__rest","guideY","_a","guideX","_b","defaultScale","newAxis","createGuideX","createGuideY","defaultAxis","tickCount","Object","assign","parentKey","margin","paddingRight","paddingBottom","frame","legend","legendFilter","setData","position","P","X","Y","reverse","restEncode","$x","$y","push","RepeatMatrix","newOptions","of","call","value"],"sources":["composition/repeatMatrix.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}