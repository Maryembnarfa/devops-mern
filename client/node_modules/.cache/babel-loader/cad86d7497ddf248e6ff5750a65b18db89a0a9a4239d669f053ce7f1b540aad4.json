{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { deepMix } from '@antv/util';\nimport { group } from '@antv/vendor/d3-array';\nimport { subObject } from '../utils/helper';\nimport { createDatumof, createValueof, mergeState, offsetTransform, renderBackground, renderLink, selectElementByData, selectG2Elements, selectPlotArea, useState } from './utils';\n/**\n * highlight a group of elements.\n */\nexport function elementHighlight(root, _ref) {\n  let {\n    elements: elementsof,\n    // given the root of chart returns elements to be manipulated\n    datum,\n    // given each element returns the datum of it\n    groupKey = d => d,\n    // group elements by specified key\n    link = false,\n    // draw link or not\n    background = false,\n    // draw background or not\n    delay = 60,\n    // delay to unhighlighted element\n    scale,\n    coordinate,\n    emitter,\n    state = {}\n  } = _ref;\n  var _a;\n  const elements = elementsof(root);\n  const elementSet = new Set(elements);\n  const keyGroup = group(elements, groupKey);\n  const valueof = createValueof(elements, datum);\n  const [appendLink, removeLink] = renderLink(Object.assign({\n    elements,\n    valueof,\n    link,\n    coordinate\n  }, subObject(state.active, 'link')));\n  const [appendBackground, removeBackground, isBackground] = renderBackground(Object.assign({\n    document: root.ownerDocument,\n    scale,\n    coordinate,\n    background,\n    valueof\n  }, subObject(state.active, 'background')));\n  const elementStyle = deepMix(state, {\n    active: Object.assign({}, ((_a = state.active) === null || _a === void 0 ? void 0 : _a.offset) && {\n      //Apply translate to mock slice out.\n      transform: function () {\n        for (var _len = arguments.length, params = new Array(_len), _key = 0; _key < _len; _key++) {\n          params[_key] = arguments[_key];\n        }\n        const value = state.active.offset(...params);\n        const [, i] = params;\n        return offsetTransform(elements[i], value, coordinate);\n      }\n    })\n  });\n  const {\n    setState,\n    removeState,\n    hasState\n  } = useState(elementStyle, valueof);\n  let out; // Timer for delaying unhighlighted.\n  const pointerover = event => {\n    const {\n      target: element,\n      nativeEvent = true\n    } = event;\n    if (!elementSet.has(element)) return;\n    if (out) clearTimeout(out);\n    const k = groupKey(element);\n    const group = keyGroup.get(k);\n    const groupSet = new Set(group);\n    for (const e of elements) {\n      if (groupSet.has(e)) {\n        if (!hasState(e, 'active')) setState(e, 'active');\n      } else {\n        setState(e, 'inactive');\n        removeLink(e);\n      }\n      if (e !== element) removeBackground(e);\n    }\n    appendBackground(element);\n    appendLink(group);\n    // Emit events.\n    if (!nativeEvent) return;\n    emitter.emit('element:highlight', {\n      nativeEvent,\n      data: {\n        data: datum(element),\n        group: group.map(datum)\n      }\n    });\n  };\n  const delayUnhighlighted = () => {\n    if (out) clearTimeout(out);\n    out = setTimeout(() => {\n      unhighlighted();\n      out = null;\n    }, delay);\n  };\n  const unhighlighted = function () {\n    let nativeEvent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n    for (const e of elements) {\n      removeState(e, 'active', 'inactive');\n      removeBackground(e);\n      removeLink(e);\n    }\n    if (nativeEvent) {\n      emitter.emit('element:unhighlight', {\n        nativeEvent\n      });\n    }\n  };\n  const pointerout = event => {\n    const {\n      target: element\n    } = event;\n    if (background && !isBackground(element)) return;\n    if (!background && !elementSet.has(element)) return;\n    if (delay > 0) delayUnhighlighted();else unhighlighted();\n  };\n  const pointerleave = () => {\n    unhighlighted();\n  };\n  root.addEventListener('pointerover', pointerover);\n  root.addEventListener('pointerout', pointerout);\n  root.addEventListener('pointerleave', pointerleave);\n  const onRest = e => {\n    const {\n      nativeEvent\n    } = e;\n    if (nativeEvent) return;\n    unhighlighted(false);\n  };\n  const onHighlight = e => {\n    const {\n      nativeEvent\n    } = e;\n    if (nativeEvent) return;\n    const {\n      data\n    } = e.data;\n    const element = selectElementByData(elements, data, datum);\n    if (!element) return;\n    pointerover({\n      target: element,\n      nativeEvent: false\n    });\n  };\n  emitter.on('element:highlight', onHighlight);\n  emitter.on('element:unhighlight', onRest);\n  return () => {\n    root.removeEventListener('pointerover', pointerover);\n    root.removeEventListener('pointerout', pointerout);\n    root.removeEventListener('pointerleave', pointerleave);\n    emitter.off('element:highlight', onHighlight);\n    emitter.off('element:unhighlight', onRest);\n    for (const e of elements) {\n      removeBackground(e);\n      removeLink(e);\n    }\n  };\n}\nexport function ElementHighlight(_a) {\n  var {\n      delay,\n      createGroup,\n      background = false,\n      link = false\n    } = _a,\n    rest = __rest(_a, [\"delay\", \"createGroup\", \"background\", \"link\"]);\n  return (context, _, emitter) => {\n    const {\n      container,\n      view,\n      options\n    } = context;\n    const {\n      scale,\n      coordinate\n    } = view;\n    const plotArea = selectPlotArea(container);\n    return elementHighlight(plotArea, Object.assign({\n      elements: selectG2Elements,\n      datum: createDatumof(view),\n      groupKey: createGroup ? createGroup(view) : undefined,\n      coordinate,\n      scale,\n      state: mergeState(options, [['active', background ? {} : {\n        lineWidth: '1',\n        stroke: '#000'\n      }], 'inactive']),\n      background,\n      link,\n      delay,\n      emitter\n    }, rest));\n  };\n}\nElementHighlight.props = {\n  reapplyWhenUpdate: true\n};","map":{"version":3,"names":["deepMix","group","subObject","createDatumof","createValueof","mergeState","offsetTransform","renderBackground","renderLink","selectElementByData","selectG2Elements","selectPlotArea","useState","elementHighlight","root","_ref","elements","elementsof","datum","groupKey","d","link","background","delay","scale","coordinate","emitter","state","elementSet","Set","keyGroup","valueof","appendLink","removeLink","Object","assign","active","appendBackground","removeBackground","isBackground","document","ownerDocument","elementStyle","_a","offset","transform","_len","arguments","length","params","Array","_key","value","i","setState","removeState","hasState","out","pointerover","event","target","element","nativeEvent","has","clearTimeout","k","get","groupSet","e","emit","data","map","delayUnhighlighted","setTimeout","unhighlighted","undefined","pointerout","pointerleave","addEventListener","onRest","onHighlight","on","removeEventListener","off","ElementHighlight","createGroup","rest","__rest","context","_","container","view","options","plotArea","lineWidth","stroke","props","reapplyWhenUpdate"],"sources":["interaction/elementHighlight.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}