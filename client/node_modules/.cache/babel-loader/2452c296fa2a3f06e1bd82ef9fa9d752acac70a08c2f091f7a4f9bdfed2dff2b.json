{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { Canvas as GCanvas } from '@antv/g';\nimport { Renderer as CanvasRenderer } from '@antv/g-canvas';\nimport { Plugin as DragAndDropPlugin } from '@antv/g-plugin-dragndrop';\nimport { debounce } from '@antv/util';\nimport EventEmitter from '@antv/event-emitter';\nimport { render, destroy } from '../runtime';\nimport { ChartEvent } from '../utils/event';\nimport { normalizeContainer, removeContainer, sizeOf, optionsOf, updateRoot, createEmptyPromise, REMOVE_FLAG } from './utils';\nimport { CompositionNode } from './composition';\nimport { defineProps, nodeProps } from './define';\nimport { MarkNode } from './mark';\nimport { library } from './library';\nexport const G2_CHART_KEY = 'G2_CHART_KEY';\nexport class Runtime extends CompositionNode {\n  constructor(options) {\n    const {\n        container,\n        canvas,\n        renderer,\n        plugins,\n        lib,\n        createCanvas\n      } = options,\n      rest = __rest(options, [\"container\", \"canvas\", \"renderer\", \"plugins\", \"lib\", \"createCanvas\"]);\n    super(rest, 'view');\n    // Identifies whether bindAutoFit.\n    this._hasBindAutoFit = false;\n    this._rendering = false;\n    this._trailing = false;\n    this._trailingResolve = null;\n    this._trailingReject = null;\n    this._previousDefinedType = null;\n    this._onResize = debounce(() => {\n      this.forceFit();\n    }, 300);\n    this._renderer = renderer || new CanvasRenderer();\n    this._plugins = plugins || [];\n    this._container = normalizeContainer(container);\n    this._emitter = new EventEmitter();\n    this._context = {\n      library: Object.assign(Object.assign({}, lib), library),\n      emitter: this._emitter,\n      canvas,\n      createCanvas\n    };\n    this._create();\n  }\n  render() {\n    if (this._rendering) return this._addToTrailing();\n    if (!this._context.canvas) this._createCanvas();\n    this._bindAutoFit();\n    this._rendering = true;\n    const finished = new Promise((resolve, reject) => render(this._computedOptions(), this._context, this._createResolve(resolve), this._createReject(reject)));\n    const [finished1, resolve, reject] = createEmptyPromise();\n    finished.then(resolve).catch(reject).then(() => this._renderTrailing());\n    return finished1;\n  }\n  /**\n   * @overload\n   * @param {G2ViewTree} [options]\n   * @returns {Runtime|Spec}\n   */\n  options(options) {\n    if (arguments.length === 0) return optionsOf(this);\n    const {\n      type\n    } = options;\n    if (type) this._previousDefinedType = type;\n    updateRoot(this, options, this._previousDefinedType, this._marks, this._compositions);\n    return this;\n  }\n  getContainer() {\n    return this._container;\n  }\n  getContext() {\n    return this._context;\n  }\n  on(event, callback, once) {\n    this._emitter.on(event, callback, once);\n    return this;\n  }\n  once(event, callback) {\n    this._emitter.once(event, callback);\n    return this;\n  }\n  emit(event) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    this._emitter.emit(event, ...args);\n    return this;\n  }\n  off(event, callback) {\n    this._emitter.off(event, callback);\n    return this;\n  }\n  clear() {\n    const options = this.options();\n    this.emit(ChartEvent.BEFORE_CLEAR);\n    this._reset();\n    destroy(options, this._context, false);\n    this.emit(ChartEvent.AFTER_CLEAR);\n  }\n  destroy() {\n    const options = this.options();\n    this.emit(ChartEvent.BEFORE_DESTROY);\n    this._unbindAutoFit();\n    this._reset();\n    destroy(options, this._context, true);\n    if (this._container[REMOVE_FLAG]) removeContainer(this._container);\n    this.emit(ChartEvent.AFTER_DESTROY);\n  }\n  forceFit() {\n    // Don't fit if size do not change.\n    this.options['autoFit'] = true;\n    const {\n      width,\n      height\n    } = sizeOf(this.options(), this._container);\n    if (width === this._width && height === this._height) {\n      return Promise.resolve(this);\n    }\n    // Don't call changeSize to prevent update width and height of options.\n    this.emit(ChartEvent.BEFORE_CHANGE_SIZE);\n    const finished = this.render();\n    finished.then(() => {\n      this.emit(ChartEvent.AFTER_CHANGE_SIZE);\n    });\n    return finished;\n  }\n  changeSize(width, height) {\n    if (width === this._width && height === this._height) {\n      return Promise.resolve(this);\n    }\n    this.emit(ChartEvent.BEFORE_CHANGE_SIZE);\n    this.attr('width', width);\n    this.attr('height', height);\n    const finished = this.render();\n    finished.then(() => {\n      this.emit(ChartEvent.AFTER_CHANGE_SIZE);\n    });\n    return finished;\n  }\n  _create() {\n    const {\n      library\n    } = this._context;\n    // @todo After refactor component as mark, remove this.\n    const isMark = key => key.startsWith('mark.') || key === 'component.axisX' || key === 'component.axisY' || key === 'component.legends';\n    const marks = ['mark.mark', ...Object.keys(library).filter(isMark)];\n    // Create mark generators.\n    this._marks = {};\n    for (const key of marks) {\n      const name = key.split('.').pop();\n      class Mark extends MarkNode {\n        constructor() {\n          super({}, name);\n        }\n      }\n      this._marks[name] = Mark;\n      this[name] = function (composite) {\n        const node = this.append(Mark);\n        if (name === 'mark') node.type = composite;\n        return node;\n      };\n    }\n    // Create composition generators.\n    const compositions = ['composition.view', ...Object.keys(library).filter(key => key.startsWith('composition.') && key !== 'composition.mark')];\n    this._compositions = Object.fromEntries(compositions.map(key => {\n      const name = key.split('.').pop();\n      let Composition = class Composition extends CompositionNode {\n        constructor() {\n          super({}, name);\n        }\n      };\n      Composition = __decorate([defineProps(nodeProps(this._marks))], Composition);\n      return [name, Composition];\n    }));\n    for (const Ctor of Object.values(this._compositions)) {\n      defineProps(nodeProps(this._compositions))(Ctor);\n    }\n    for (const key of compositions) {\n      const name = key.split('.').pop();\n      this[name] = function () {\n        const Composition = this._compositions[name];\n        this.type = null;\n        return this.append(Composition);\n      };\n    }\n  }\n  _reset() {\n    const KEYS = ['theme', 'type', 'width', 'height', 'autoFit'];\n    this.type = 'view';\n    this.value = Object.fromEntries(Object.entries(this.value).filter(_ref => {\n      let [key] = _ref;\n      return key.startsWith('margin') || key.startsWith('padding') || key.startsWith('inset') || KEYS.includes(key);\n    }));\n    this.children = [];\n  }\n  _renderTrailing() {\n    if (!this._trailing) return;\n    this._trailing = false;\n    this.render().then(() => {\n      const trailingResolve = this._trailingResolve.bind(this);\n      this._trailingResolve = null;\n      trailingResolve(this);\n    }).catch(error => {\n      const trailingReject = this._trailingReject.bind(this);\n      this._trailingReject = null;\n      trailingReject(error);\n    });\n  }\n  _createResolve(resolve) {\n    return () => {\n      this._rendering = false;\n      resolve(this);\n    };\n  }\n  _createReject(reject) {\n    return error => {\n      this._rendering = false;\n      reject(error);\n    };\n  }\n  // Update actual size and key.\n  _computedOptions() {\n    const options = this.options();\n    const {\n      key = G2_CHART_KEY\n    } = options;\n    const {\n      width,\n      height,\n      depth\n    } = sizeOf(options, this._container);\n    this._width = width;\n    this._height = height;\n    this._key = key;\n    return Object.assign(Object.assign({\n      key: this._key\n    }, options), {\n      width,\n      height,\n      depth\n    });\n  }\n  // Create canvas if it does not exist.\n  // DragAndDropPlugin is for interaction.\n  // It is OK to register more than one time, G will handle this.\n  _createCanvas() {\n    const {\n      width,\n      height\n    } = sizeOf(this.options(), this._container);\n    this._plugins.push(new DragAndDropPlugin());\n    this._plugins.forEach(d => this._renderer.registerPlugin(d));\n    this._context.canvas = new GCanvas({\n      container: this._container,\n      width,\n      height,\n      renderer: this._renderer\n    });\n  }\n  _addToTrailing() {\n    var _a;\n    // Resolve previous promise, and give up this task.\n    (_a = this._trailingResolve) === null || _a === void 0 ? void 0 : _a.call(this, this);\n    // Create new task.\n    this._trailing = true;\n    const promise = new Promise((resolve, reject) => {\n      this._trailingResolve = resolve;\n      this._trailingReject = reject;\n    });\n    return promise;\n  }\n  _bindAutoFit() {\n    const options = this.options();\n    const {\n      autoFit\n    } = options;\n    if (this._hasBindAutoFit) {\n      // If it was bind before, unbind it now.\n      if (!autoFit) this._unbindAutoFit();\n      return;\n    }\n    if (autoFit) {\n      this._hasBindAutoFit = true;\n      window.addEventListener('resize', this._onResize);\n    }\n  }\n  _unbindAutoFit() {\n    if (this._hasBindAutoFit) {\n      this._hasBindAutoFit = false;\n      window.removeEventListener('resize', this._onResize);\n    }\n  }\n}","map":{"version":3,"names":["Canvas","GCanvas","Renderer","CanvasRenderer","Plugin","DragAndDropPlugin","debounce","EventEmitter","render","destroy","ChartEvent","normalizeContainer","removeContainer","sizeOf","optionsOf","updateRoot","createEmptyPromise","REMOVE_FLAG","CompositionNode","defineProps","nodeProps","MarkNode","library","G2_CHART_KEY","Runtime","constructor","options","container","canvas","renderer","plugins","lib","createCanvas","rest","__rest","_hasBindAutoFit","_rendering","_trailing","_trailingResolve","_trailingReject","_previousDefinedType","_onResize","forceFit","_renderer","_plugins","_container","_emitter","_context","Object","assign","emitter","_create","_addToTrailing","_createCanvas","_bindAutoFit","finished","Promise","resolve","reject","_computedOptions","_createResolve","_createReject","finished1","then","catch","_renderTrailing","arguments","length","type","_marks","_compositions","getContainer","getContext","on","event","callback","once","emit","_len","args","Array","_key","off","clear","BEFORE_CLEAR","_reset","AFTER_CLEAR","BEFORE_DESTROY","_unbindAutoFit","AFTER_DESTROY","width","height","_width","_height","BEFORE_CHANGE_SIZE","AFTER_CHANGE_SIZE","changeSize","attr","isMark","key","startsWith","marks","keys","filter","name","split","pop","Mark","composite","node","append","compositions","fromEntries","map","Composition","__decorate","Ctor","values","KEYS","value","entries","_ref","includes","children","trailingResolve","bind","error","trailingReject","depth","push","forEach","d","registerPlugin","_a","call","promise","autoFit","window","addEventListener","removeEventListener"],"sources":["api/runtime.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}