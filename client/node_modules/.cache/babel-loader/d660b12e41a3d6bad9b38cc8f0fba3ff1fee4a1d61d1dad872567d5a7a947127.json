{"ast":null,"code":"import { deepMix } from '@antv/util';\nimport { column, columnOf, maybeColumnOf } from './utils/helper';\nimport { createGroups } from './utils/order';\n/**\n * The DiffY transform apply offset for y0 channels.\n * Keep y unchanged, set y1 = max(otherY), if y1 > y, remove the data.\n */\nexport const DiffY = function () {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const {\n    groupBy = 'x',\n    series = true\n  } = options;\n  return (I, mark) => {\n    const {\n      encode\n    } = mark;\n    const [Y] = columnOf(encode, 'y');\n    const [_, fy1] = columnOf(encode, 'y1');\n    const [S] = series ? maybeColumnOf(encode, 'series', 'color') : columnOf(encode, 'color');\n    // Create groups and apply specified order for each group.\n    const groups = createGroups(groupBy, I, mark);\n    // Only adjust Y1 channel.\n    const newY1 = new Array(I.length);\n    for (const G of groups) {\n      const YG = G.map(i => +Y[i]);\n      // Process each series.\n      for (let idx = 0; idx < G.length; idx++) {\n        const i = G[idx];\n        // Get the max Y of current group with current Y exclude.\n        const max = Math.max(...YG.filter((_, _i) => _i !== idx));\n        // Diff Y value.\n        newY1[i] = +Y[i] > max ? max : Y[i];\n      }\n    }\n    return [I, deepMix({}, mark, {\n      encode: {\n        y1: column(newY1, fy1)\n      }\n    })];\n  };\n};\nDiffY.props = {};","map":{"version":3,"names":["deepMix","column","columnOf","maybeColumnOf","createGroups","DiffY","options","arguments","length","undefined","groupBy","series","I","mark","encode","Y","_","fy1","S","groups","newY1","Array","G","YG","map","i","idx","max","Math","filter","_i","y1","props"],"sources":["transform/diffY.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,OAAO,QAAQ,YAAY;AAGpC,SAASC,MAAM,EAAEC,QAAQ,EAAEC,aAAa,QAAQ,gBAAgB;AAChE,SAASC,YAAY,QAAQ,eAAe;AAI5C;;;;AAIA,OAAO,MAAMC,KAAK,GAAqB,SAAAA,CAAA,EAAiB;EAAA,IAAhBC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EAClD,MAAM;IAAEG,OAAO,GAAG,GAAG;IAAEC,MAAM,GAAG;EAAI,CAAE,GAAGL,OAAO;EAChD,OAAO,CAACM,CAAC,EAAEC,IAAI,KAAI;IACjB,MAAM;MAAEC;IAAM,CAAE,GAAGD,IAAI;IACvB,MAAM,CAACE,CAAC,CAAC,GAAGb,QAAQ,CAACY,MAAM,EAAE,GAAG,CAAC;IACjC,MAAM,CAACE,CAAC,EAAEC,GAAG,CAAC,GAAGf,QAAQ,CAACY,MAAM,EAAE,IAAI,CAAC;IAEvC,MAAM,CAACI,CAAC,CAAC,GAAGP,MAAM,GACdR,aAAa,CAACW,MAAM,EAAE,QAAQ,EAAE,OAAO,CAAC,GACxCZ,QAAQ,CAACY,MAAM,EAAE,OAAO,CAAC;IAE7B;IACA,MAAMK,MAAM,GAAGf,YAAY,CAACM,OAAO,EAAEE,CAAC,EAAEC,IAAI,CAAC;IAE7C;IACA,MAAMO,KAAK,GAAG,IAAIC,KAAK,CAACT,CAAC,CAACJ,MAAM,CAAC;IACjC,KAAK,MAAMc,CAAC,IAAIH,MAAM,EAAE;MACtB,MAAMI,EAAE,GAAGD,CAAC,CAACE,GAAG,CAAEC,CAAC,IAAK,CAACV,CAAC,CAACU,CAAC,CAAC,CAAC;MAC9B;MACA,KAAK,IAAIC,GAAG,GAAG,CAAC,EAAEA,GAAG,GAAGJ,CAAC,CAACd,MAAM,EAAEkB,GAAG,EAAE,EAAE;QACvC,MAAMD,CAAC,GAAGH,CAAC,CAACI,GAAG,CAAC;QAChB;QACA,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,GAAGJ,EAAE,CAACM,MAAM,CAAC,CAACb,CAAC,EAAEc,EAAE,KAAKA,EAAE,KAAKJ,GAAG,CAAC,CAAC;QACzD;QACAN,KAAK,CAACK,CAAC,CAAC,GAAG,CAACV,CAAC,CAACU,CAAC,CAAC,GAAGE,GAAG,GAAGA,GAAG,GAAGZ,CAAC,CAACU,CAAC,CAAC;;;IAIvC,OAAO,CACLb,CAAC,EACDZ,OAAO,CAAC,EAAE,EAAEa,IAAI,EAAE;MAChBC,MAAM,EAAE;QACNiB,EAAE,EAAE9B,MAAM,CAACmB,KAAK,EAAEH,GAAG;;KAExB,CAAC,CACH;EACH,CAAC;AACH,CAAC;AAEDZ,KAAK,CAAC2B,KAAK,GAAG,EAAE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}