{"ast":null,"code":"import { deepMix } from '@antv/util';\nimport { rollups, sum } from '@antv/vendor/d3-array';\nimport { columnOf } from './utils/helper';\nfunction valueOf(data, field) {\n  if (typeof field === 'string') return data.map(d => d[field]);\n  return data.map(field);\n}\nfunction createReducer(reducer, V) {\n  if (typeof reducer === 'function') return GI => reducer(GI, V);\n  if (reducer === 'sum') return GI => sum(GI, i => +V[i]);\n  throw new Error(`Unknown reducer: ${reducer}`);\n}\n/**\n * Produce flex options from data for x scale.\n */\nexport const FlexX = function () {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const {\n    field,\n    channel = 'y',\n    reducer = 'sum'\n  } = options;\n  return (I, mark) => {\n    const {\n      data,\n      encode\n    } = mark;\n    const [x] = columnOf(encode, 'x');\n    const V = field ? valueOf(data, field) : columnOf(encode, channel)[0];\n    const reducerFunction = createReducer(reducer, V);\n    const flex = rollups(I, reducerFunction, i => x[i]).map(d => d[1]);\n    return [I, deepMix({}, mark, {\n      scale: {\n        x: {\n          flex\n        }\n      }\n    })];\n  };\n};\nFlexX.props = {};","map":{"version":3,"names":["deepMix","rollups","sum","columnOf","valueOf","data","field","map","d","createReducer","reducer","V","GI","i","Error","FlexX","options","arguments","length","undefined","channel","I","mark","encode","x","reducerFunction","flex","scale","props"],"sources":["transform/flexX.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,OAAO,QAAQ,YAAY;AACpC,SAASC,OAAO,EAAEC,GAAG,QAAmB,uBAAuB;AAG/D,SAASC,QAAQ,QAAQ,gBAAgB;AAIzC,SAASC,OAAOA,CAACC,IAAS,EAAEC,KAA4B;EACtD,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE,OAAOD,IAAI,CAACE,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACF,KAAK,CAAC,CAAC;EAC/D,OAAOD,IAAI,CAACE,GAAG,CAACD,KAAK,CAAC;AACxB;AAEA,SAASG,aAAaA,CACpBC,OAAgC,EAChCC,CAAc;EAEd,IAAI,OAAOD,OAAO,KAAK,UAAU,EAAE,OAAQE,EAAY,IAAKF,OAAO,CAACE,EAAE,EAAED,CAAC,CAAC;EAC1E,IAAID,OAAO,KAAK,KAAK,EAAE,OAAQE,EAAY,IAAKV,GAAG,CAACU,EAAE,EAAGC,CAAC,IAAK,CAACF,CAAC,CAACE,CAAC,CAAC,CAAC;EACrE,MAAM,IAAIC,KAAK,CAAC,oBAAoBJ,OAAO,EAAE,CAAC;AAChD;AAEA;;;AAGA,OAAO,MAAMK,KAAK,GAAqB,SAAAA,CAAA,EAAiB;EAAA,IAAhBC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EAClD,MAAM;IAAEX,KAAK;IAAEc,OAAO,GAAG,GAAG;IAAEV,OAAO,GAAG;EAAK,CAAE,GAAGM,OAAO;EACzD,OAAO,CAACK,CAAC,EAAEC,IAAI,KAAI;IACjB,MAAM;MAAEjB,IAAI;MAAEkB;IAAM,CAAE,GAAGD,IAAI;IAC7B,MAAM,CAACE,CAAC,CAAC,GAAGrB,QAAQ,CAACoB,MAAM,EAAE,GAAG,CAAC;IACjC,MAAMZ,CAAC,GAAGL,KAAK,GAAGF,OAAO,CAACC,IAAI,EAAEC,KAAK,CAAC,GAAGH,QAAQ,CAACoB,MAAM,EAAEH,OAAO,CAAC,CAAC,CAAC,CAAC;IACrE,MAAMK,eAAe,GAAGhB,aAAa,CAACC,OAAO,EAAEC,CAAC,CAAC;IACjD,MAAMe,IAAI,GAAGzB,OAAO,CAACoB,CAAC,EAAEI,eAAe,EAAGZ,CAAC,IAAKW,CAAC,CAACX,CAAC,CAAC,CAAC,CAACN,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAAC,CAAC,CAAC,CAAC;IACtE,OAAO,CAACa,CAAC,EAAErB,OAAO,CAAC,EAAE,EAAEsB,IAAI,EAAE;MAAEK,KAAK,EAAE;QAAEH,CAAC,EAAE;UAAEE;QAAI;MAAE;IAAE,CAAE,CAAC,CAAC;EAC3D,CAAC;AACH,CAAC;AAEDX,KAAK,CAACa,KAAK,GAAG,EAAE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}