{"ast":null,"code":"import { isArray, get } from '@antv/util';\nimport { stratify, hierarchy, treemap as treemapLayout, treemapBinary, treemapDice, treemapSlice, treemapSliceDice, treemapSquarify, treemapResquarify } from '@antv/vendor/d3-hierarchy';\nimport { field } from '../mark/utils';\n/**\n * @description Path need when the data is a flat json structure,\n * and the tree object structure do not need.\n */\nfunction generateHierarchyRoot(data, path) {\n  if (Array.isArray(data)) {\n    return typeof path === 'function' ? stratify().path(path)(data) : stratify()(data);\n  }\n  return hierarchy(data);\n}\nfunction addObjectDataPath(root) {\n  let path = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [root.data.name];\n  // @ts-ignore\n  root.id = root.id || root.data.name;\n  root.path = path;\n  if (root.children) {\n    root.children.forEach(item => {\n      // @ts-ignore\n      item.id = `${root.id}/${item.data.name}`;\n      item.path = [...path, item.data.name];\n      addObjectDataPath(item, item.path);\n    });\n  }\n}\nfunction addArrayDataPath(root) {\n  const name = get(root, ['data', 'name']);\n  if (name.replaceAll) {\n    root.path = name.replaceAll('.', '/').split('/');\n  }\n  if (root.children) {\n    root.children.forEach(item => {\n      addArrayDataPath(item);\n    });\n  }\n}\nfunction getTileMethod(tile, ratio) {\n  const tiles = {\n    treemapBinary,\n    treemapDice,\n    treemapSlice,\n    treemapSliceDice,\n    treemapSquarify,\n    treemapResquarify\n  };\n  const tileMethod = tile === 'treemapSquarify' ? tiles[tile].ratio(ratio) : tiles[tile];\n  if (!tileMethod) {\n    throw new TypeError('Invalid tile method!');\n  }\n  return tileMethod;\n}\nexport function treeDataTransform(data, layout, encode) {\n  const {\n    value\n  } = encode;\n  const tileMethod = getTileMethod(layout.tile, layout.ratio);\n  const root = generateHierarchyRoot(data, layout.path);\n  if (isArray(data)) {\n    addArrayDataPath(root);\n  } else {\n    addObjectDataPath(root);\n  }\n  // Calculate the value and sort.\n  value ? root.sum(d => layout.ignoreParentValue && d.children ? 0 : field(value)(d)).sort(layout.sort) : root.count();\n  treemapLayout().tile(tileMethod)\n  // @ts-ignore\n  .size(layout.size).round(layout.round).paddingInner(layout.paddingInner).paddingOuter(layout.paddingOuter).paddingTop(layout.paddingTop).paddingRight(layout.paddingRight).paddingBottom(layout.paddingBottom).paddingLeft(layout.paddingLeft)(root);\n  const nodes = root.descendants().map(d => Object.assign(d, {\n    id: d.id.replace(/^\\//, ''),\n    x: [d.x0, d.x1],\n    y: [d.y0, d.y1]\n  }));\n  const filterData = nodes.filter(typeof layout.layer === 'function' ? layout.layer : d => d.height === layout.layer);\n  return [filterData, nodes];\n}","map":{"version":3,"names":["isArray","get","stratify","hierarchy","treemap","treemapLayout","treemapBinary","treemapDice","treemapSlice","treemapSliceDice","treemapSquarify","treemapResquarify","field","generateHierarchyRoot","data","path","Array","addObjectDataPath","root","arguments","length","undefined","name","id","children","forEach","item","addArrayDataPath","replaceAll","split","getTileMethod","tile","ratio","tiles","tileMethod","TypeError","treeDataTransform","layout","encode","value","sum","d","ignoreParentValue","sort","count","size","round","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft","nodes","descendants","map","Object","assign","replace","x","x0","x1","y","y0","y1","filterData","filter","layer","height"],"sources":["utils/treeDataTransform.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}