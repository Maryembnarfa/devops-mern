name: Deploy to Server

on:
  push:
    branches:
      - main  # DÃ©clenchement du pipeline sur un push dans "main"

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest  # ExÃ©cution sur une machine virtuelle Ubuntu

    steps:
      # Ã‰tape 1 : Checkout du code
      - name: ðŸ”„ Checkout du code
        uses: actions/checkout@v3  # TÃ©lÃ©charge le code du dÃ©pÃ´t GitHub

      # Ã‰tape 2 : Connexion Ã  Docker Hub (utilisation de secrets)
      - name: ðŸ”‘ Connexion Ã  Docker Hub
        run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

      # Ã‰tape 3 : Build et push des images Docker
      - name: ðŸ“¦ Build et push des images Docker
        run: |
          docker build -t ${{ secrets.DOCKER_USERNAME }}/livraison-frontend:latest ./client  # Construit l'image frontend
          docker build -t ${{ secrets.DOCKER_USERNAME }}/livraison-backend:latest ./server   # Construit l'image backend
          docker push ${{ secrets.DOCKER_USERNAME }}/livraison-frontend:latest  # Pousse l'image frontend sur Docker Hub
          docker push ${{ secrets.DOCKER_USERNAME }}/livraison-backend:latest   # Pousse l'image backend sur Docker Hub
